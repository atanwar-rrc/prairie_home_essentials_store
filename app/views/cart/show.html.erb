<section class="cart-card">
  <h1 class="mb-4">Your cart</h1>

  <% if @cart.present? && @items.present? %>
    <table class="table align-middle">
      <thead>
        <tr>
          <th scope="col">Product</th>
          <th scope="col" class="text-center">Qty</th>
          <th scope="col" class="text-end">Price</th>
          <th scope="col" class="text-end">Subtotal</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <% total = 0 %>
        <% @items.each do |product| %>
          <% quantity = @cart[product.id.to_s].to_i %>
          <% subtotal = product.price * quantity %>
          <% total += subtotal %>
          <tr>
            <td>
              <strong><%= product.name %></strong><br>
              <small class="text-muted"><%= truncate(product.description, length: 80) %></small>
            </td>
            <td class="text-center"><%= quantity %></td>
            <td class="text-end"><%= number_to_currency(product.price) %></td>
            <td class="text-end fw-semibold"><%= number_to_currency(subtotal) %></td>
            <td class="text-end">
              <%= link_to "Remove", remove_from_cart_path(product), method: :delete,
                          class: "btn btn-sm btn-outline-secondary" %>
            </td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" class="text-end">Total</td>
          <td class="text-end fw-bold fs-5"><%= number_to_currency(total) %></td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="d-flex flex-wrap gap-3">
      <%= link_to "Continue shopping", products_path, class: "btn btn-outline-secondary" %>
      <%= link_to "Proceed to checkout", new_order_path, class: "btn btn-primary" %>
    </div>
  <% else %>
    <p class="lead">Your cart is empty right now.</p>
    <%= link_to "Browse products", products_path, class: "btn btn-primary" %>
  <% end %>
</section>