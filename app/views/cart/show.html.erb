<h1>Your Shopping Cart</h1>

<% if @cart.present? %>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Product</th>
        <th class="text-center">Qty</th>
        <th class="text-end">Price</th>
        <th class="text-end">Subtotal</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% total = 0 %>
      <% @items.each do |product| %>
        <% quantity = @cart[product.id.to_s].to_i %>
        <% subtotal = product.price * quantity %>
        <% total += subtotal %>
        <tr>
          <td><%= product.name %></td>
          <td class="text-center"><%= quantity %></td>
          <td class="text-end"><%= number_to_currency(product.price) %></td>
          <td class="text-end"><%= number_to_currency(subtotal) %></td>
          <td class="text-end">
            <%= link_to "Remove", remove_from_cart_path(product), method: :delete,
                        class: "btn btn-danger btn-sm" %>
          </td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="3" class="text-end fw-bold">Total:</td>
        <td class="text-end fw-bold"><%= number_to_currency(total) %></td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <%= link_to "Continue shopping", products_path, class: "btn btn-outline-secondary me-2" %>
  <%= link_to "Proceed to Checkout", new_order_path, class: "btn btn-primary" %>
<% else %>
  <p>Your cart is empty.</p>
  <%= link_to "Browse products", products_path, class: "btn btn-primary" %>
<% end %>
