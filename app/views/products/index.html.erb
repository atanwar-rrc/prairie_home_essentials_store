<% featured = @featured_product %>

<section class="site-hero mb-5">
  <div class="site-hero__inner">
    <div>
      <span class="site-hero__eyebrow">Prairie curated living</span>
      <h1 class="site-hero__title">Everything you need for a calm, comfortable home.</h1>
      <p class="site-hero__copy">
        Layer rich textures, warm lighting, and durable prairie-ready essentials. Browse mindful collections
        designed to make real homes feel welcoming in every season.
      </p>
      <div class="site-hero__cta">
        <%= link_to "Browse collections", products_path, class: "btn btn-primary" %>
        <%= link_to "View cart", cart_path, class: "btn btn-outline-secondary" %>
      </div>
    </div>
    <div class="site-hero__figure">
      <% if featured&.image_url.present? %>
        <img src="<%= featured.image_url %>" alt="<%= featured.name %> styled interior" />
      <% else %>
        <img src="https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?auto=format&fit=crop&w=1400&q=80" alt="Prairie home inspiration" />
      <% end %>
      <div class="site-hero__stats">
        <div class="site-hero__stat">
          <span><%= @hero_stats[:products] %>+</span>
          <span>Products</span>
        </div>
        <div class="site-hero__stat">
          <span><%= @hero_stats[:categories] %></span>
          <span>Categories</span>
        </div>
        <div class="site-hero__stat">
          <span><%= @hero_stats[:satisfaction] %></span>
          <span>Guest rating</span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="product-filter">
  <div class="d-flex flex-column flex-lg-row align-items-lg-end gap-3">
    <%= form_with url: products_path, method: :get, local: true, class: "row g-3 flex-grow-1" do %>
      <div class="col-lg-6">
        <%= label_tag :search, "Search", class: "form-label fw-semibold" %>
        <%= text_field_tag :search, params[:search], class: "form-control form-control-lg", placeholder: "Search sofas, throws, lighting..." %>
      </div>
      <div class="col-lg-4">
        <%= label_tag :category_id, "Category", class: "form-label fw-semibold" %>
        <%= select_tag :category_id,
              options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
              include_blank: "All collections",
              class: "form-select form-select-lg" %>
      </div>
      <div class="col-lg-2 d-grid">
        <%= submit_tag "Filter", class: "btn btn-primary btn-lg" %>
      </div>
    <% end %>
    <% if @highlight_categories.any? %>
      <div class="d-flex flex-wrap gap-2">
        <% @highlight_categories.each do |category| %>
          <span class="badge-category"><%= category.name %></span>
        <% end %>
      </div>
    <% end %>
  </div>
</section>

<section class="service-grid">
  <% @service_highlights.each do |highlight| %>
    <article class="service-card">
      <h3><%= highlight[:title] %></h3>
      <p><%= highlight[:body] %></p>
    </article>
  <% end %>
</section>

<section id="product-grid" class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
  <%= render partial: "product", collection: @products, as: :product %>
</section>

<% if @low_stock_products.any? %>
  <section class="low-stock">
    <div class="low-stock__header">
      <h2>Almost gone favourites</h2>
      <p>These pieces are nearly sold through for the season-add them now and we will hold them for 48 hours.</p>
    </div>
    <div class="low-stock__grid">
      <% @low_stock_products.each do |product| %>
        <div class="low-stock__card">
          <div>
            <strong><%= product.name %></strong>
            <p><%= truncate(product.description, length: 110) %></p>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-semibold"><%= number_to_currency(product.price) %></span>
            <%= link_to "Quick view", product_path(product), class: "btn btn-outline-secondary btn-sm" %>
          </div>
          <small class="text-muted">Only <%= product.stock %> left in stock</small>
        </div>
      <% end %>
    </div>
  </section>
<% end %>

<section class="testimonial-grid">
  <% @testimonials.each do |testimonial| %>
    <figure class="testimonial-card">
      <blockquote>"<%= testimonial[:quote] %>"</blockquote>
      <figcaption><%= testimonial[:name] %></figcaption>
    </figure>
  <% end %>
</section>

<section class="cta-banner">
  <div class="cta-banner__content">
    <div>
      <h2>Book a 20-minute styling session</h2>
      <p>Share photos of your space and we will respond with a layered shopping list that honours your prairie light and layout.</p>
    </div>
    <% if (contact_page = Page.find_by(slug: 'contact')) %>
      <%= link_to "Schedule now", page_path(contact_page), class: "btn btn-primary btn-lg" %>
    <% else %>
      <a class="btn btn-primary btn-lg" href="mailto:hello@prairiehome.ca">Schedule now</a>
    <% end %>
  </div>
</section>
